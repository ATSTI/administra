CREATE OR ALTER PROCEDURE SP_CONTAS_PENDENTES (
    DTAINI Date,
    DTAFIM Date,
    COD_FOR Integer,
    COD_CCUSTO Smallint,
    COD_CONTA Integer,
    COD_CAIXA Smallint )
RETURNS (
    DTAEMISSAO Date,
    DTAVENC Date,
    CODFORN Integer,
    FORNECEDOR Varchar(60),
    DESCRICAO Varchar(180),
    VALORRESTO Double precision,
    VALORPAGO Double precision,
    CONTACONTABIL Varchar(200),
    CAIXA Varchar(60),
    CODCONTA Varchar(15),
    STATUS Varchar(30) )
AS
DECLARE VARIABLE CCAIXA INTEGER;
DECLARE VARIABLE N_TITULO VARCHAR(15);
DECLARE VARIABLE CCONTABIL INTEGER;
BEGIN



  /* Lista os pagamentos efetuados */ 


  FOR SELECT pag.EMISSAO ,pag.DATAVENCIMENTO, CAST(pag.CODFORNECEDOR AS VARCHAR(10)) || '-' ||  forn.NOMEFORNECEDOR, 
    pag.TITULO || '-' || pag.HISTORICO, pag.VALOR_RESTO, pag.VALORRECEBIDO, pag.TITULO,pag.CAIXA, pag.STATUS  
    FROM PAGAMENTO pag, FORNECEDOR forn where forn.CODFORNECEDOR = pag.CODFORNECEDOR 
    and ((pag.status = '5-')) and pag.DATAVENCIMENTO BETWEEN :DTAINI AND :DTAFIM
    and ((pag.CODFORNECEDOR = :cod_for) or (:cod_for = 9999999))
    and ((pag.CODALMOXARIFADO = :COD_CCUSTO) or (:COD_CCUSTO = 0))
    and ((pag.CONTACREDITO = :COD_CONTA) or (:COD_CONTA = 9999999))
    and ((pag.CAIXA = :COD_CAIXA) or (:COD_CAIXA = 0))
    order by pag.DATAVENCIMENTO
  INTO :DTAEMISSAO, :DTAVENC, :FORNECEDOR, :DESCRICAO, :VALORRESTO, :VALORPAGO, :CCONTABIL, :CCAIXA, :STATUS 
  DO BEGIN

    SELECT NOME, CODREDUZIDO FROM PLANO WHERE CODIGO = :CCONTABIL
    INTO :CONTACONTABIL, :CODCONTA;
    CONTACONTABIL = CODCONTA || '-' || CONTACONTABIL;
    SELECT NOME FROM PLANO WHERE CODIGO = :CCAIXA
    INTO :CAIXA;

    IF (STATUS = '5-') THEN
      STATUS = 'Pendente';
   

    SUSPEND;
    contacontabil = null;
  END
END

