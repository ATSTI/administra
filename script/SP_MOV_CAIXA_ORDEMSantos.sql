CREATE OR ALTER PROCEDURE SP_MOV_CAIXA_ORDEM(
  DTAINI DATE,
  DTAFIM DATE,
  COD_CAIXA SMALLINT,
  COD_ORIGEM integer)
RETURNS(
  DTAPAGTO DATE,
  ORDEM SMALLINT,
  DESCRICAO VARCHAR(150) CHARACTER SET WIN1252,
  VALORC DOUBLE PRECISION,
  VALORD DOUBLE PRECISION,
  VALOR DOUBLE PRECISION,
  CONTACONTABIL VARCHAR(200) CHARACTER SET WIN1252,
  CAIXA VARCHAR(60) CHARACTER SET WIN1252,
  CODCONTA VARCHAR(15) CHARACTER SET WIN1252,
  FORMA VARCHAR(15) CHARACTER SET WIN1252,
  CODORIGEM INTEGER,
  CODRECEBIMENTO integer)
AS
BEGIN
  SELECT FIRST 1 VALOR FROM SP_MOV_CAIXA(:DTAINI, :DTAFIM, :COD_CAIXA, :COD_ORIGEM)
  INTO :VALOR;

  FOR SELECT DTAPAGTO, ORDEM, DESCRICAO, VALORC, VALORD, CONTACONTABIL, CAIXA, CODCONTA, FORMA, ORIGEM, codRECEBE
     FROM SP_MOV_CAIXA(:DTAINI, :DTAFIM, :COD_CAIXA, :COD_ORIGEM) ORDER BY DTAPAGTO, ORDEM
  INTO :DTAPAGTO, :ORDEM, :DESCRICAO, :VALORC, :VALORD, :CONTACONTABIL, :CAIXA, :CODCONTA, :FORMA, :CODORIGEM, :CODRECEBIMENTO
  DO BEGIN
    VALOR = VALOR + VALORD - VALORC;
    SUSPEND;
  END
END;
